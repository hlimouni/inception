FROM alpine:3.14

# Environment vars

ARG MYSQL_USER

ARG MYSQL_ROOT_PASSWORD

ARG MYSQL_PASSWORD

# Install dependencies

RUN apk update && \
    apk add --no-cache openrc && \
    mkdir -p /run/openrc && \
    touch /run/openrc/softlevel && \
    apk add mariadb mariadb-client

# Upload mariadb config

COPY /conf/mariadb-server.cnf /etc/my.cnf.d

# Config privileges mysql> scripts

RUN mkdir /etc/scripts && \ chmod 777 /etc/scripts

COPY /tools/configbase.sql /etc/scripts

COPY /tools/fill.sh /etc/scripts

RUN /etc/scripts/fill.sh

# Setup MariaDB

COPY /tools/setup_mb.sh /

RUN sh setup_mb.sh

EXPOSE 3306

CMD ["mysqld_safe"]